<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hogwarts Cinema</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: var(--tg-theme-bg-color, #141414);
            --text-color: var(--tg-theme-text-color, #ffffff);
            --card-bg: var(--tg-theme-secondary-bg-color, #2b2b2b);
            --btn-color: var(--tg-theme-button-color, #2481cc);
        }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-color); 
            margin: 0; padding: 15px; text-align: center;
        }
        h2 { font-weight: 800; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 20px;}
        
        /* 1-QAVAT: TIL TANLASH */
        #lang-screen { display: flex; flex-direction: column; gap: 15px; margin-top: 50px; }
        .lang-btn {
            background-color: var(--card-bg); color: var(--text-color);
            border: 2px solid var(--btn-color); border-radius: 12px;
            padding: 20px; font-size: 18px; font-weight: bold; cursor: pointer;
            transition: 0.2s;
        }
        .lang-btn:active { background-color: var(--btn-color); }

        /* 2-QAVAT: KATALOG */
        #catalog-screen { display: none; }
        .back-btn {
            background-color: transparent; border: 1px solid gray; color: gray;
            padding: 8px 15px; border-radius: 8px; margin-bottom: 20px; cursor: pointer;
        }
        .catalog-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px;
        }
        .movie-card { 
            background-color: var(--card-bg); border-radius: 12px; overflow: hidden;
            display: flex; flex-direction: column; padding-bottom: 10px;
        }
        .movie-card img { width: 100%; height: 210px; object-fit: cover; display: block; margin-bottom: 10px;}
        .movie-title { font-size: 13px; font-weight: bold; margin: 0 5px 10px 5px; height: 32px; overflow: hidden;}
        .play-btn { 
            background-color: var(--btn-color); color: white; border: none;
            padding: 10px; border-radius: 6px; font-weight: bold; width: 90%; margin: 0 auto; cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="lang-screen">
        <h2>Tilni tanlang</h2>
        <button class="lang-btn" onclick="openCatalog('uz')">üá∫üáø O'zbek tili</button>
        <button class="lang-btn" onclick="openCatalog('ru')">üá∑üá∫ –†—É—Å—Å–∫–∏–π —è–∑—ã–∫</button>
        <button class="lang-btn" onclick="openCatalog('en')">üá¨üáß English</button>
    </div>

    <div id="catalog-screen">
        <button class="back-btn" onclick="goBack()">üîô Tilni o'zgartirish</button>
        <h2 id="catalog-title">Katalog</h2>
        <div class="catalog-grid" id="grid"></div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        let currentLang = 'uz';

        // Tizimli yondashuv: Kinolar haqida baza
        const movies = [
            { id: "hp1", title_uz: "Falsafa Toshi", title_ru: "–§–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π –∫–∞–º–µ–Ω—å", title_en: "Philosopher's Stone" },
            { id: "hp2", title_uz: "Maxfiy Hujra", title_ru: "–¢–∞–π–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞", title_en: "Chamber of Secrets" },
            { id: "hp3", title_uz: "Azkaban Mahbusi", title_ru: "–£–∑–Ω–∏–∫ –ê–∑–∫–∞–±–∞–Ω–∞", title_en: "Prisoner of Azkaban" },
            { id: "hp4", title_uz: "Olovli Kubok", title_ru: "–ö—É–±–æ–∫ –æ–≥–Ω—è", title_en: "Goblet of Fire" },
            { id: "hp5", title_uz: "Feniks Jamiyati", title_ru: "–û—Ä–¥–µ–Ω –§–µ–Ω–∏–∫—Å–∞", title_en: "Order of the Phoenix" },
            { id: "hp6", title_uz: "Chalasang Shahzoda", title_ru: "–ü—Ä–∏–Ω—Ü-–ø–æ–ª—É–∫—Ä–æ–≤–∫–∞", title_en: "Half-Blood Prince" },
            { id: "hp7", title_uz: "Ajal Tuhfasi 1", title_ru: "–î–∞—Ä—ã –°–º–µ—Ä—Ç–∏ 1", title_en: "Deathly Hallows 1" },
            { id: "hp8", title_uz: "Ajal Tuhfasi 2", title_ru: "–î–∞—Ä—ã –°–º–µ—Ä—Ç–∏ 2", title_en: "Deathly Hallows 2" }
        ];

        function openCatalog(lang) {
            currentLang = lang;
            document.getElementById('lang-screen').style.display = 'none';
            document.getElementById('catalog-screen').style.display = 'block';
            
            // Sarlavhani tilga moslash
            if(lang === 'uz') document.getElementById('catalog-title').innerText = "üé¨ O'zbekcha Katalog";
            if(lang === 'ru') document.getElementById('catalog-title').innerText = "üé¨ –ö–∞—Ç–∞–ª–æ–≥ –Ω–∞ —Ä—É—Å—Å–∫–æ–º";
            if(lang === 'en') document.getElementById('catalog-title').innerText = "üé¨ English Catalog";

            renderMovies();
        }

        function goBack() {
            document.getElementById('catalog-screen').style.display = 'none';
            document.getElementById('lang-screen').style.display = 'flex';
        }

        function renderMovies() {
            const grid = document.getElementById('grid');
            grid.innerHTML = ''; // Ekranni tozalash

            movies.forEach(movie => {
                const card = document.createElement('div');
                card.className = 'movie-card';
                
                // MANTIQ: ID va Tilni birlashtirib rasmni topish (Masalan: img/hp1_uz.jpg)
                let imagePath = `img/${movie.id}_${currentLang}.jpg`;
                
                // Tilga mos nomni tanlash
                let title = currentLang === 'uz' ? movie.title_uz : (currentLang === 'ru' ? movie.title_ru : movie.title_en);
                let btnText = currentLang === 'uz' ? "Ko'rish" : (currentLang === 'ru' ? "–°–º–æ—Ç—Ä–µ—Ç—å" : "Watch");

                card.innerHTML = `
                    <img src="${imagePath}" alt="${title}" onerror="this.src='https://via.placeholder.com/150?text=Poster+Topilmadi'">
                    <p class="movie-title">${title}</p>
                    <button class="play-btn" onclick="requestMovie('${movie.id}_${currentLang}')">‚ñ∂ ${btnText}</button>
                `;
                grid.appendChild(card);
            });
        }

        function requestMovie(payload) {
            let botUsername = "garripotterkinobot"; // O'zingnikini tekshirib qo'y
            let link = `https://t.me/${botUsername}?start=${payload}`;
            tg.openTelegramLink(link);
            tg.close();
        }
    </script>
</body>
</html>
